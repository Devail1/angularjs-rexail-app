<div ng-cloak class="store-bg">
    <div class="categories-wrapper" ng-cloack>
        <div class="container mx-auto h-full display-flex align-center justify-evenly font-gray-900">
            <li class="category"
                ng-repeat="category in ctrl.state.data.categoriesData | limitTo: 10"
                ng-if="category.children.length"
                ng-click="ctrl.handleCategoryClick(category)"
                ng-style="ctrl.state.selectedCategory.id === category.id ? { 'color': '#33cc66', 'border-bottom': '2px solid #33cc66' , 'font-weight' : '600' } : {}">
                {{category.name}}&nbsp;
            </li>
            <div class="display-flex align-center relative" ng-if="ctrl.showMoreCategories()">
                <ul class="category category-show-more" ng-mouseover="isOpened=true"
                    ng-mouseleave="isOpened = false"> עוד
                    <div ng-if="isOpened"
                         class="categories-show-more display-flex flex-vertical absolute pt-10 rounded-10">
                        <li class="category show-more"
                            ng-repeat="category in ctrl.state.data.categoriesData | limitTo: ctrl.state.data.categoriesData.length : 10 "
                            ng-style="{ 'background': (isHover ? '#F5F3F0' : '#fff') }" ng-mouseenter="isHover = true;"
                            ng-mouseleave="isHover = false;"
                            ng-click="ctrl.handleCategoryClick(category);"
                        >
                            {{category.name}}
                        </li>
                    </div>
                </ul>
            </div>
        </div>
    </div>
    <div class="container mx-auto pt-20">
        <div class="display-flex relative">
            <div class="store-widget">
                <div class="display-flex justify-between align-center">
                    <h1 class="font-heebo font-blue">{{ctrl.state.selectedCategory.name}}</h1>
                    <div class="sort-items c-p display-flex justify-between">
                                <span class="font-blue">
                                    מיין לפי
                                </span>
                        <svg class="icon-arrow-down" viewBox="0 0 11 11" xmlns="http://www.w3.org/2000/svg">
                            <path d="M5.5 6.746 1.341 2.587a.786.786 0 0 0-1.11 1.111l4.713 4.715a.786.786 0 0 0 1.112 0l4.714-4.715a.786.786 0 0 0-1.111-1.11L5.5 6.745z"
                                  fill="currentColor" fill-rule="evenodd"/>
                        </svg>
                    </div>
                </div>
                <div>
                    <div infinite-scroll="loadMore()" infinite-scroll-distance="3" class="store-items-wrapper mt-30">
                        <div ng-repeat="product in ctrl.state.selectedCategory.children  | filter: ctrl.state.searchQuery | limitTo: paginationLimit">
                            <store-item product="product"
                                        img-base-url="ctrl.imgBaseUrl"
                                        increase-product-quantity="ctrl.increaseProductQuantity(product)"
                                        decrease-product-quantity="ctrl.decreaseProductQuantity(product)"
                            ></store-item>
                        </div>
                    </div>
                </div>
            </div>
            <div class="cart-preview rounded-10">
                <div class="cart-preview-header display-flex align-center px-16">
                    <img class="w-22 h-22 ml-10" ng-src="assets/icons/button-arrow-up.svg"/>
                    <img class="icon-basket" src="assets/icons/shape.svg"><span
                        class="text-sm font-white absolute mr-46 mt-8"> {{ctrl.state.cartItems.length}}</span></img>
                    <div class="display-flex flex-vertical font-white mr-8 ml-auto">
                        <span class="text-light font-size-14">סל הקניות שלי</span>
                        <span class="font-size-18">{{ctrl.state.total}}</span>
                    </div>
                    <button type="button" class="proceed-to-checkout-btn font-white font-size-16" ng-class="!ctrl.state.cartItems.length ? 'btn-disabled not-active' : ''">המשך
                        לתשלום
                    </button>
                </div>
                <div class="cart-preview-subheader px-16">
                    <div class="c-p display-flex align-center h-full w-85 mr-auto" ng-click="ctrl.clearCart()">
                        <img ng-src="assets/icons/icon-trash.svg"/>
                        <span class="mr-5 font-size-14">
                            מחיקת סל
                        </span>
                    </div>
                </div>
                <div class="cart-items-preview-wrapper">
                    <div class="display-flex flex-vertical align-center pt-20" ng-if="!ctrl.state.cartItems.length">
                        <img ng-src="assets/img/empty-basket.png"/>
                        <span class="mt-10 font-size-22 font-blue text-bolder font-heebo">סל הקניות שלכם ריק</span>
                        <span class="font-blue font-size-16">התחילו להוסיף מוצרים</span>
                    </div>
                    <item-preview ng-repeat="product in ctrl.state.cartItems track by product.id" product="product"
                                  img-base-url="ctrl.imgBaseUrl"
                                  increase-product-quantity="ctrl.increaseProductQuantity(product)"
                                  decrease-product-quantity="ctrl.decreaseProductQuantity(product)"
                                  remove-product="ctrl.removeProduct(product)"
                    ></item-preview>
                </div>
                <div class="cart-preview-footer px-28 display-flex flex-vertical align-center justify-center">
                    <button type="button" class="btn-green w-full" ng-class="!ctrl.state.cartItems.length ? 'btn-disabled not-active' : ''">
                        <span class="font-white checkout-text">המשך לתשלום</span>
                        <span class="font-white total-sum">₪{{ctrl.state.total}}</span>
                    </button>
                    <span class="font-darkgray font-size-14">שערוך. עלות סופית לפני שקילה.</span>
                </div>
            </div>
        </div>
    </div>
    <ul>
        <li><a href="/cart">navigate to cart</a></li>
        <li><a href="/checkout">navigate to checkout</a></li>
    </ul>
    <footer></footer>
</div>
